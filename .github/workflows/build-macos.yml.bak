# macOS Build Job (backup for later use)
# Copy this into build.yml when macOS support is needed

  build-macos:
    runs-on: macos-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Setup CMake
      run: brew install cmake

    # Check AE SDK
    - name: Check AE SDK
      run: |
        if [ -f "include/AE_SDK/AE_Effect.h" ]; then
          echo "AE SDK found"
        else
          echo "::warning::AE SDK not found. Please add SDK to repository."
          mkdir -p include/AE_SDK
        fi

    # Configure CMake
    - name: Configure CMake
      run: |
        cmake -B build \
          -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }} \
          -DCMAKE_OSX_ARCHITECTURES="x86_64;arm64" \
          -DAE_SDK_PATH="${{ github.workspace }}/include/AE_SDK"

    # Build
    - name: Build
      run: cmake --build build --config ${{ env.BUILD_TYPE }} --parallel
      continue-on-error: true  # macOS build may fail without full setup

    # Package
    - name: Package Plugin
      run: |
        mkdir -p artifacts/JustGlow-macOS

        # Copy plugin bundle if exists
        if [ -d "build/JustGlow.plugin" ]; then
          cp -R "build/JustGlow.plugin" "artifacts/JustGlow-macOS/"
        elif [ -d "build/${{ env.BUILD_TYPE }}/JustGlow.plugin" ]; then
          cp -R "build/${{ env.BUILD_TYPE }}/JustGlow.plugin" "artifacts/JustGlow-macOS/"
        fi
      continue-on-error: true

    # Upload
    - name: Upload macOS Artifact
      uses: actions/upload-artifact@v4
      with:
        name: JustGlow-macOS-Universal
        path: artifacts/JustGlow-macOS/
        retention-days: 30
      if: always()

# Release job should have:
#   needs: [build-windows, build-macos]
# And add macOS artifact download:
#
#    - name: Download macOS artifact
#      uses: actions/download-artifact@v4
#      with:
#        name: JustGlow-macOS-Universal
#        path: release/macos
#      continue-on-error: true
#
#    - name: Create Release Archives
#      run: |
#        cd release
#        zip -r ../JustGlow-${{ github.ref_name }}-Windows-x64.zip windows/
#        if [ -d "macos" ] && [ "$(ls -A macos)" ]; then
#          zip -r ../JustGlow-${{ github.ref_name }}-macOS-Universal.zip macos/
#        fi
